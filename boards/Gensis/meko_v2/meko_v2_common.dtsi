#include <zephyr/dt-bindings/mipi_dbi/mipi_dbi.h>
#include <dt-bindings/regulator/npm13xx.h>

/ {

    chosen {
        zephyr,display=&epd;
    };

    aliases {
        vib-motor = &vib_motor;
    };

    pwm_motor_driver {
        compatible = "pwm-leds";

        vib_motor: vib_motor {
            pwms = <&pwm0 1 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
            label = "Vibration Motor";
        };
    };

    dac_avdd: dac-avdd {
        compatible = "regulator-fixed";
        regulator-name = "sensor_supply";

        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;

        enable-gpios = <&gpio1 9 GPIO_ACTIVE_HIGH>;

        startup-delay-us = <1000>;
        regulator-boot-on;
    };

    buttons {
        compatible = "gpio-keys";

        debounce-interval-ms = <300>;

        button_power: button-0 {
            gpios = <&gpio0 27 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
            label = "Power button";
            zephyr,code = <INPUT_KEY_0>;
        };

        button_side_left: button-1 {
            gpios = <&gpio0 5 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
            label = "Left side button";
            zephyr,code = <INPUT_KEY_1>;
        };

        button_side_right: button-2 {
            gpios = <&gpio0 30 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
            label = "Right side button";
            zephyr,code = <INPUT_KEY_2>;
        };

        button_volume_up: button-3 {
            gpios = <&gpio1 0 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
            label = "Volume up button";
            zephyr,code = <INPUT_KEY_3>;
        };

        button_volume_down: button-4 {
            gpios = <&gpio1 5 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
            label = "Volume down button";
            zephyr,code = <INPUT_KEY_4>;
        };
    };

    mipi_dbi {
        status = "okay";
        compatible = "zephyr,mipi-dbi-spi";
        spi-dev = <&spi2>;

        dc-gpios = <&gpio0  14 GPIO_ACTIVE_HIGH>;
        reset-gpios = <&gpio0 12 GPIO_ACTIVE_LOW>;

        #address-cells = <1>;
        #size-cells = <0>;

        epd: ssd16xx@0 {
            status = "okay";
            compatible = "solomon,ssd1681";
            mipi-max-frequency = <500000>;
            reg = <0>;

            width = <200>;
            height = <200>;

            rotation = <270>;

            busy-gpios = <&gpio0 13 GPIO_ACTIVE_HIGH>;

            tssv = <0x80>;

            full {
                border-waveform = <0x05>;
            };

            partial {
                border-waveform = <0x3c>;
            };
        };
    };
};

&pwm0 {
    status = "okay";
    pinctrl-0 = <&pwm0_default>;
    pinctrl-1 = <&pwm0_sleep>;
    pinctrl-names = "default", "sleep";
};

&gpio0 {
    status = "okay";
};

&gpio1 {
    status = "okay";
};

&gpiote {
    status = "okay";
};

&hfxo {
    load-capacitors = "internal";
    load-capacitance-femtofarad = <12000>;
};

&lfxo {
    load-capacitors = "internal";
    load-capacitance-picofarad = <7>;
};

&spi4 {
    compatible = "nordic,nrf-spim";
    status = "okay";
    cs-gpios = <&gpio0 11 GPIO_ACTIVE_LOW>;
    pinctrl-0 = <&spi4_default>;
    pinctrl-1 = <&spi4_sleep>;
    pinctrl-names = "default", "sleep";

    sdhc0: sdhc@0 {
        compatible = "zephyr,sdhc-spi-slot";
        reg = <0>;
        status = "okay";
        spi-max-frequency = <8000000>;

        sdmmc {
            compatible = "zephyr,sdmmc-disk";
            disk-name = "SD";
            status = "okay";
        };
    };
};

&spi2 {
    compatible = "nordic,nrf-spim";
    status = "okay";
    pinctrl-0 = <&spi2_default>;
    pinctrl-1 = <&spi2_sleep>;
    pinctrl-names = "default", "sleep";
    cs-gpios = <&gpio0 16 GPIO_ACTIVE_LOW>;
};

&i2c1 {
    compatible = "nordic,nrf-twim";
    status = "okay";
    pinctrl-0 = <&i2c1_default>;
    pinctrl-1 = <&i2c1_sleep>;
    pinctrl-names = "default", "sleep";
    clock-frequency = <I2C_BITRATE_FAST>;

    as5600: as5600@36 {
        compatible = "ams,as5600";
        reg = <0x36>;

        friendly-name = "hall rotation sensor";
    };

    tad5212: tad5212@50 {
        compatible = "ti,tad5x12";
        status = "okay";

        reg = <0x50>;
    };

    npm1300_pmic: npm1300@6b {
        compatible = "nordic,npm1300";
        reg = <0x6b>;

        host-int-gpios = <&gpio0 31 0>;
        pmic-int-pin = <1>;

        npm1300_leds: led-controller {
            compatible = "nordic,npm1300-led";

            nordic,led0-mode = "host";
            nordic,led1-mode = "host";
            nordic,led2-mode = "host";
        };

        npm1300_regulators: regulators {
            compatible = "nordic,npm1300-regulator";

            npm1300_buck1: BUCK1 {
                status = "disabled";
            };

            npm1300_3v3: BUCK2 {
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
                regulator-boot-on;
            };

            npm1300_hall_pwr: LDO1 {
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
                regulator-initial-mode = <NPM13XX_LDSW_MODE_LDO>;
                regulator-boot-on;
            };

            npm1300_ldo2: LDO2 {
                status = "disabled";
            };
        };
    };
};

&i2s0 {
    compatible = "nordic,nrf-i2s";
    status = "okay";
    pinctrl-0 = <&i2s0_default>;
    pinctrl-1 = <&i2s0_sleep>;
    pinctrl-names = "default", "sleep";
};